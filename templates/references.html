{% extends "base.html" %} {% block content %}

<div
  class="modal fade"
  id="modalCenter"
  tabindex="-1"
  aria-hidden="true"
  role="dialog"
>
  <form method="POST">
    {% csrf_token %}
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalCenterTitle">
            Ma'lumotnoma qo'shish
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col mb-3">
              <label for="type" class="form-label">Ma'lumotnoma turi</label>

              <select name="type" id="types" class="form-select">
                <option value="--------" selected disabled>--------</option>
                
                <option value="3">Rang</option>
                
              </select>
            </div>
          </div>
          <div class="row g-2">
            <div class="col mb-0">
              <label for="value" class="form-label">Ma'lumotnoma qiymati</label>
              <input
                type="text"
                id="emailWithTitle"
                class="form-control"
                placeholder="Ma'lumotnoma qiymati"
                name="value"
              />
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-outline-secondary"
            data-bs-dismiss="modal"
          >
            Yopish
          </button>
          <button type="submit" class="btn btn-primary">Saqlash</button>
        </div>
      </div>
    </div>
  </form>
</div>

<div class="card  py-3 m-3 mx-4">
  <div class="card-header d-flex align-items-center justify-content-between">
    <h2 class="">Ma'lumotnoma</h2>
    <button type="button" class="btn btn-primary" id="openModal">
      Ma'lumotnoma qo'shish
    </button>
  </div>
  <div class="col-md mb-4 mb-md-0 container-fluid">
    {% for value, value_list in values.items %}
    <div class="accordion mt-3" id="accordionExample">
      <div class="card accordion-item">
        <h2 class="accordion-header" id="heading{{ forloop.counter }}">
          <button
            type="button"
            class="accordion-button collapsed"
            data-bs-toggle="collapse"
            data-bs-target="#accordion{{ forloop.counter }}"
            aria-expanded="false"
            aria-controls="accordion{{ forloop.counter }}"
          >
            {{ value }}
          </button>
        </h2>

        <div
          id="accordion{{ forloop.counter }}"
          class="accordion-collapse collapse"
          data-bs-parent="#accordionExample"
        >
          <div class="accordion-body">
            {% for value_item in value_list %}
            <div class="item border-bottom py-2 d-flex align-items-center justify-content-between">
              <h5>{{ value_item.value }}</h5>
              <!-- Edit Button -->
              <div>
              <button
                type="button"
                class="btn btn-warning btn-sm"
                data-bs-toggle="modal"
                data-bs-target="#modalCenter"
                data-action="edit"
                data-value="{{ value_item.value }}"
                data-type="{{ value }}"
                data-id="{{ value_item.id }}"
              >
              <i class="bx bx-edit"></i>

              </button>
              <!-- Delete Button -->
              <form
                action="{% url 'delete_reference' value_item.id %}"
                method="POST"
                style="display: inline"
              >
                {% csrf_token %}
                <button type="submit" class="btn btn-danger btn-sm">
                  <i class="bx bx-trash"></i>
                </button>
              </form>
            </div>

            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
      // Add click event to open the modal
      $("#openModal").click(function () {
        $("#modalCenter").modal("show"); // Use Bootstrap's modal method to show the modal
      });
  
      // Populate modal for edit functionality
      $('#modalCenter').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget); // Button that triggered the modal
        var action = button.data('action'); // Edit or Add action
        var value = button.data('value');
        var type = button.data('type');
        var id = button.data('id'); // Get the ID from the button
  
        var modal = $(this);
        if (action === 'edit') {
          modal.find('.modal-title').text('Edit Ma\'lumotnoma');
          modal.find('input[name="value"]').val(value); // Set the value in the input
          modal.find('select[name="type"]').val(type); // Set the type in the select dropdown
          modal.find('form').attr('action', "{% url 'update_reference' 0 %}".replace('0', id)); // Set form action to the correct update URL with the ID
        } else {
          modal.find('.modal-title').text('Ma\'lumotnoma qo\'shish');
          modal.find('input[name="value"]').val('');
          modal.find('select[name="type"]').val('--------');
          modal.find('form').attr('action', "{% url 'reference' %}"); // Reset the action for creating a new reference
        }
      });
    });
  </script>
  
{% endblock content %}
